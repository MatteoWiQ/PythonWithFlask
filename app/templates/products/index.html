{% extends 'base.html' %}

{% block title %}Inventario de Productos - Joyería{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-6">
            <i class="bi bi-gem text-danger"></i> Inventario de Productos
        </h1>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('product.create_get') }}" class="btn btn-success btn-lg">
            <i class="bi bi-plus-circle"></i> Nuevo Producto
        </a>
    </div>
</div>

<!-- Filtros y Búsqueda -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">
            <i class="bi bi-funnel"></i> Filtros y Búsqueda
        </h5>
    </div>
    <div class="card-body">
        <form action="{{ url_for('product.index') }}" method="GET" class="row g-3">
            <div class="col-md-4">
                <label for="search" class="form-label">Buscar por nombre</label>
                <input type="text" name="search" id="search" class="form-control" placeholder="Ej: Anillo, Collar..."
                    value="{{ search or '' }}">
            </div>
            <div class="col-md-3">
                <label for="category" class="form-label">Categoría</label>
                <input type="text" name="category" id="category" class="form-control" placeholder="Ej: Anillos..."
                    value="{{ category or '' }}">
            </div>
            <div class="col-md-2">
                <label for="min_price" class="form-label">Precio mín.</label>
                <input type="number" name="min_price" id="min_price" class="form-control" placeholder="0" 
                    value="{{ min_price or '' }}" min="0" step="0.01">
            </div>
            <div class="col-md-2">
                <label for="max_price" class="form-label">Precio máx.</label>
                <input type="number" name="max_price" id="max_price" class="form-control" placeholder="999999" 
                    value="{{ max_price or '' }}" min="0" step="0.01">
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> Filtrar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Tabla de Productos -->
<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Categoría</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>
                    {% if product.get('image_filename') and product.get('image_filename') != 'default.png' %}
                        <img src="{{ url_for('static', filename='uploads/' + product.get('image_filename')) }}"
                            alt="{{ product.get('name') }}" width="50" height="50" class="rounded object-fit-cover">
                    {% else %}
                        <div class="bg-secondary rounded d-inline-flex align-items-center justify-content-center" 
                             style="width: 50px; height: 50px; color: white;">
                            <i class="bi bi-image"></i>
                        </div>
                    {% endif %}
                </td>
                <td>
                    <strong>{{ product.get('name', 'N/A') }}</strong>
                </td>
                <td>
                    <small class="text-muted">{{ product.get('description', '')[:50] }}{% if product.get('description', '')|length > 50 %}...{% endif %}</small>
                </td>
                <td>
                    <span class="badge bg-info text-dark">{{ product.get('category', 'Sin Cat.') }}</span>
                </td>
                <td>
                    <strong class="text-success">${{ "%.2f"|format(product.get('price', 0)|float) }}</strong>
                </td>
                <td>
                    {% set stock = product.get('stock', 0) %}
                    {% if stock < 5 %}
                        <span class="badge bg-danger">{{ stock }}</span>
                    {% elif stock < 20 %}
                        <span class="badge bg-warning text-dark">{{ stock }}</span>
                    {% else %}
                        <span class="badge bg-success">{{ stock }}</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('product.detail', product_id=product._id) }}" class="btn btn-sm btn-info"
                            title="Ver detalles">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="{{ url_for('product.edit_get', product_id=product._id) }}" class="btn btn-sm btn-warning"
                            title="Editar">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{{ url_for('product.delete_get', product_id=product._id) }}" class="btn btn-sm btn-danger"
                            title="Eliminar">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                    <p class="text-muted mt-3">No se encontraron productos.</p>
                    <a href="{{ url_for('product.create_get') }}" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus-circle"></i> Crear primer producto
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}